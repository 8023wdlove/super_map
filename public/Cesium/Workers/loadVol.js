import{a as M}from"./chunk-77JEGE4I.js";import{a as m}from"./chunk-K6FM2O3N.js";import{b as k}from"./chunk-CUQT2UK5.js";import{a as b}from"./chunk-CB3KB2D3.js";import{a as O}from"./chunk-I46SWINN.js";import"./chunk-LNIYJJXS.js";import"./chunk-4D2ERGZX.js";import"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";var N=function(){var a=!![];return function(o,h){var i=a?function(){if(h){var r=h.apply(o,arguments);return h=null,r}}:function(){};return a=![],i}}(),B=N(void 0,function(){return B.toString().search("(((.+)+)+)+$").toString().constructor(B).search("(((.+)+)+)+$")});B();var v={UNLOAD:0,LOADING:1,LOADED:2,VOLLOADED:3,PARSING:4,PARSED:5,TRANSFORMING:6,TRANSFORMED:7,LOST:8,LOADVOL:9,FAILED:10,VOLFAILED:11},R=Object.freeze(v);function G(a){for(var o=1;o<a;)o<<=1;return o}function j(a){var o=new O(1,255,65025);o=O.multiplyByScalar(o,a,o),o.x=o.x-Math.floor(o.x),o.y=o.y-Math.floor(o.y),o.z=o.z-Math.floor(o.z);var h=new O,i=new O(1/255,1/255,0);return h.x=o.y*i.x,h.y=o.z*i.y,h.z=o.z*i.z,o=O.subtract(o,h,o),o}function U(a,o,h,i){for(var r=4,A=a._nLength*a._nLength*r,d=new Array(A),S=h-o,w=o,g=-9999,s=0;s<a.cellDepth;s++)for(var f=parseInt(s/a._nSideBlockCount)*a._nBlockLength,n=s%a._nSideBlockCount*a._nBlockLength,_=-1;_<a._nBlockLength-1;_++)for(var l=-1;l<a._nBlockLength-1;l++){var c=Math.min(l,a.validWidth-1),D=Math.min(_,a.validHeight-1);c=Math.max(0,c),D=Math.max(0,D);var W=0;a.ySpan>0&&(W=a.validHeight-a.cellHeight);var t,p;if(c<a.cellWidth&&D>=W?(p=0,t=s*a.cellHeight*a.cellWidth+(a.validHeight-1-D)*a.cellWidth+c):c<a.cellWidth?(a.xSpan==0?p=1:p=2,t=s*a.cellHeight*a.cellWidth+(a.validHeight-a.cellHeight-1-D)*a.cellWidth+c):D>=W?(p=1,t=s*a.cellHeight*a.cellWidth+(a.validHeight-1-D)*a.cellWidth+c-a.cellWidth):(p=3,t=s*a.cellHeight*a.cellWidth+(a.validHeight-a.cellHeight-1-D)*a.cellWidth+c-a.cellWidth),!(t<0)){var H=i[p][t],y=new b(0,0,0,0);if(H!=g){H<o||H>h?H=w:w=H,H=(H-o)/S;var z=j(H);y.x=z.x,y.y=z.y,y.z=z.z,y.w=1}var E=y.x*255,F=y.y*255,C=y.z*255,I=y.w*255;t=(f+_)*a._nLength+n+l,d[4*t]=parseInt(E),d[4*t+1]=parseInt(F),d[4*t+2]=parseInt(C),d[4*t+3]=parseInt(I)}}return new Uint8Array(d,0,A)}function $(a,o,h,i,r,A,d){for(var S=a.length,w=[],g=0;g<S;g++)w.push(a[g]._arrayBuffer.slice(36,a[g]._arrayBuffer.byteLength));var s=4*o.cellWidth*o.cellHeight*o.cellDepth,f=a[0],n=a[S-1],_=o.cellWidth,l=o.cellHeight;d.EndCol-1==n._x&&(_=d.Width-n._x*_),d.EndRow-1==n._y&&(l=d.Height-n._y*l),o.startCol=f._x,o.startRow=f._y,o.endCol=n._x,o.endRow=n._y,o.ySpan=n._y-f._y,o.xSpan=n._x-f._x,o.ySpan>0&&(l=l+o.cellHeight),o.xSpan>0&&(_=_+o.cellWidth),o._nSideBlockCount=Math.ceil(Math.sqrt(o.cellDepth)),o._nBlockLength=Math.max(l,_)+2,o._nLength=G(o._nBlockLength*o._nSideBlockCount-2),o.validWidth=_,o.validHeight=l,o.bounds=new k(f._dataBounds.west,n._dataBounds.south,n._dataBounds.east,f._dataBounds.north);var c=new k(i.west,i.south,i.east,i.north);o.multiResolutionTranslation=new b((f._dataBounds.west-c.west)/c.width,(n._dataBounds.south-c.south)/c.height,c.width/o.bounds.width,c.height/o.bounds.height);for(var D=[],W=0;W<h;W++){for(var t=[],g=0;g<w.length;g++){var p=new Float32Array(w[g].slice(W*s,(W+1)*s));t.push(p)}D.push(U(o,r,A,t))}return D}function q(a,o){for(var h=a.arrayWork,i=[],r=0;r<h.length;r++)if(h[r]._s3mLoadState===R.LOADED){var A=h[r]._arrayBuffer.slice(16,h[r]._arrayBuffer.byteLength),d=M.inflate(A).buffer;h[r]._arrayBuffer=d,h[r]._s3mLoadState=R.TRANSFORMED,i.push({index:r,buffer:d})}var S=a.textureLevel,w=a._availableNode,g=a._time,s=a._layerBounds,f=a._minFiltration,n=a._maxFiltration;S.cellWidth=a._cellWidth,S.cellHeight=a._cellHeight,S.cellDepth=a._cellDepth;var _=$(h,S,g,s,f,n,w);return{textureLevel:S,imageDatas:_,unzipTile:i}}var u=m(q);export{u as default};
