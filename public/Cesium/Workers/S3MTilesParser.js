import{a as it}from"./chunk-6MIPKMCQ.js";import{a as Ar}from"./chunk-YUC7VGSC.js";import{a as Kr}from"./chunk-77JEGE4I.js";import{a as et}from"./chunk-K6FM2O3N.js";import{b as Xr,c as Jr}from"./chunk-5IORCEOD.js";import{a as at}from"./chunk-IMPZ7UGB.js";import"./chunk-XKBSMKNP.js";import{b as Zr}from"./chunk-45OWWDV7.js";import{a as h}from"./chunk-JX5O4HI2.js";import"./chunk-6S43R6PL.js";import"./chunk-TW5GUTQO.js";import"./chunk-ZRLECQ27.js";import"./chunk-CB3KB2D3.js";import{a as A,c as pr}from"./chunk-I46SWINN.js";import"./chunk-LNIYJJXS.js";import"./chunk-4D2ERGZX.js";import"./chunk-EDZQSM3T.js";import"./chunk-PJGSCWXZ.js";import{a as X}from"./chunk-NUC3LT2W.js";import"./chunk-SFC4FDPW.js";//! Use DXT1 compression.
var Mr=1<<0;//! Use DXT3 compression.
var ot=1<<1;//! Use DXT5 compression.
var Qr=1<<2;//! Use a very slow but very high quality colour compressor.
var an=1<<8;//! Use a slow but high quality colour compressor (the default).
var on=1<<3;//! Use a fast but low quality colour compressor.
var un=1<<4;//! Weight the colour by alpha during cluster fit (disabled by default).
var sn=1<<7,ut=1<<5;function st(i,o,n,e){var a=i|o<<8,r=a>>11&31,t=a>>5&63,u=a&31;return n[e+0]=r<<3|r>>2,n[e+1]=t<<2|t>>4,n[e+2]=u<<3|u>>2,n[e+3]=255,a}function Ut(i,o,n,e){for(var a=new Uint8Array(16),r=st(o[n+0],o[n+1],a,0),t=st(o[n+2],o[n+3],a,4),u=0;u<3;u++){var v=a[u],s=a[4+u];e&&r<=t?(a[8+u]=(v+s)/2,a[12+u]=0):(a[8+u]=(2*v+s)/3,a[12+u]=(v+2*s)/3)}a[8+3]=255,a[12+3]=e&&r<=t?0:255;for(var l=new Uint8Array(16),u=0;u<4;++u){var x=o[n+4+u];l[4*u+0]=x&3,l[4*u+1]=x>>2&3,l[4*u+2]=x>>4&3,l[4*u+3]=x>>6&3}for(var u=0;u<16;++u)for(var E=4*l[u],y=0;y<4;++y)i[4*u+y]=a[E+y]}function Dt(i,o,n){for(var e=0;e<8;++e){var a=bytes[n+e],r=a&15,t=a&240;i[8*e+3]=r|r<<4,i[8*e+7]=t|t>>4}}function St(i,o,v){var e=o[v+0],a=o[v+1],r=new Uint8Array(8);if(r[0]=e,r[1]=a,e<=a){for(var t=1;t<5;++t)r[1+t]=((5-t)*e+t*a)/5;r[6]=0,r[7]=255}else for(var t=1;t<7;++t)r[1+t]=((7-t)*e+t*a)/7;for(var u=new Uint8Array(16),v=v+2,s=0,t=0;t<2;++t){for(var l=0,x=0;x<3;++x){var E=o[v++];l|=E<<8*x}for(var x=0;x<8;++x){var y=l>>3*x&7;u[s++]=y}}for(var t=0;t<16;++t)i[4*t+3]=r[u[t]]}function It(i,o,n,e){var a=0;(e&(ot|Qr))!=0&&(a=8),Ut(i,o,n+a,(e&Mr)!=0),(e&ot)!=0?Dt(i,o,n):(e&Qr)!=0&&St(i,o,n)}function Nt(i,o,n,e){for(var a=new Uint16Array(4),r=i,t=0,u=0,v=0,s=0,l=0,x=0,E=0,y=0,c=0,m=o/4,f=n/4,B=0;B<f;B++)for(var T=0;T<m;T++)v=4*((f-B)*m+T),a[0]=e[v],a[1]=e[v+1],s=a[0]&31,l=a[0]&2016,x=a[0]&63488,E=a[1]&31,y=a[1]&2016,c=a[1]&63488,a[2]=5*s+3*E>>3|5*l+3*y>>3&2016|5*x+3*c>>3&63488,a[3]=5*E+3*s>>3|5*y+3*l>>3&2016|5*c+3*x>>3&63488,t=e[v+2],u=B*4*o+T*4,r[u]=a[t&3],r[u+1]=a[t>>2&3],r[u+2]=a[t>>4&3],r[u+3]=a[t>>6&3],u+=o,r[u]=a[t>>8&3],r[u+1]=a[t>>10&3],r[u+2]=a[t>>12&3],r[u+3]=a[t>>14],t=e[v+3],u+=o,r[u]=a[t&3],r[u+1]=a[t>>2&3],r[u+2]=a[t>>4&3],r[u+3]=a[t>>6&3],u+=o,r[u]=a[t>>8&3],r[u+1]=a[t>>10&3],r[u+2]=a[t>>12&3],r[u+3]=a[t>>14];return r}/*! @brief Decompresses an image in memory.

 @param rgba		Storage for the decompressed pixels.
 @param width	The width of the source image.
 @param height	The height of the source image.
 @param blocks	The compressed DXT blocks.
 @param flags	Compression flags.

 The decompressed pixels will be written as a contiguous array of width*height
 16 rgba values, with each component as 1 byte each. In memory this is:

 { r1, g1, b1, a1, .... , rn, gn, bn, an } for n = width*height

 The flags parameter should specify either kDxt1, kDxt3 or kDxt5 compression,
 however, DXT1 will be used by default if none is specified. All other flags
 are ignored.

 Internally this function calls squish::Decompress for each block.
 */function Mt(i,o,n,e,a){for(var r=(a&Mr)!=0?8:16,t=0,u=0;u<n;u+=4)for(var v=0;v<o;v+=4){var s=new Uint8Array(64);It(s,e,t,a);for(var l=0,x=0;x<4;++x)for(var E=0;E<4;++E){var y=v+E,c=u+x;if(y<o&&c<n)for(var m=4*(o*(n-c)+y),f=0;f<4;++f)i[m++]=s[l++];else l+=4}t+=r}}function vt(i){}vt.decode=function(i,o,n,e,a){if(!(i==null||e==null||n==0||o==0)){var r=0;a>Ar.BGR||a===Ar.LUMINANCE_ALPHA?r=Qr:r=Mr|ut,r&Mr&&r&ut?Nt(i,o,n,e):Mt(i,o,n,e,r)}};var Et=vt;var zt=function(){var i=!![];return function(o,n){var e=i?function(){if(n){var a=n.apply(o,arguments);return n=null,a}}:function(){};return i=![],e}}(),Wr=zt(void 0,function(){return Wr.toString().search("(((.+)+)+)+$").toString().constructor(Wr).search("(((.+)+)+)+$")});Wr();var Ft={encNONE:0,enrS3TCDXTN:14,enrPVRTPF_PVRTC2:19,enrPVRTPF_PVRTC:20,enrPVRTPF_PVRTC_4bpp:21,enrPVRTPF_ETC1:22},xt=Object.freeze(Ft);var Rt=function(){var i=!![];return function(o,n){var e=i?function(){if(n){var a=n.apply(o,arguments);return n=null,a}}:function(){};return i=![],e}}(),Hr=Rt(void 0,function(){return Hr.toString().search("(((.+)+)+)+$").toString().constructor(Hr).search("(((.+)+)+)+$")});Hr();function jr(){}jr.computeNeighbors=function(i,o){for(var n=i.length/3,e=new Uint32Array(o+1),a=new Uint32Array(o+1),r=function(B,T){B<T?e[B+1]++:a[T+1]++},t=0;t<n;t++){var u=i[3*t],v=i[3*t+1],s=i[3*t+2];r(u,v),r(v,s),r(s,u)}for(t=v=u=0;t<o;t++)s=e[t+1],r=a[t+1],e[t+1]=u,a[t+1]=v,u+=s,v+=r;for(var l=new Uint32Array(6*n),x=e[o],r=function(g,D,P){if(g<D){var L=e[g+1]++;l[2*L]=D,l[2*L+1]=P}else L=a[D+1]++,l[2*x+2*L]=g,l[2*x+2*L+1]=P},t=0;t<n;t++)u=i[3*t],v=i[3*t+1],s=i[3*t+2],r(u,v,t),r(v,s,t),r(s,u,t);for(u=function(B,T){var g=2*B;for(B=T-B,T=1;T<B;T++){var D=l[g+2*T],P=l[g+2*T+1],L=T-1;for(L;0<=L&&l[g+2*L]>D;L--)l[g+2*L+2]=l[g+2*L],l[g+2*L+3]=l[g+2*L+1];l[g+2*L+2]=D,l[g+2*L+3]=P}},t=0;t<o;t++)u(e[t],e[t+1]),u(x+a[t],x+a[t+1]);for(var E=new Int32Array(3*n),y=function(D,P){return D===i[3*P]?0:D===i[3*P+1]?1:D===i[3*P+2]?2:-1},n=function(D,P){D=y(D,P),E[3*P+D]=-1},u=function(D,P,L,N){D=y(D,P),E[3*P+D]=N,L=y(L,N),E[3*N+L]=P},t=0;t<o;t++){for(var v=e[t],s=e[t+1],r=a[t],c=a[t+1];v<s&&r<c;){var m=l[2*v],f=l[2*x+2*r];m===f?(u(t,l[2*v+1],f,l[2*x+2*r+1]),v++,r++):m<f?(n(t,l[2*v+1]),v++):(n(f,l[2*x+2*r+1]),r++)}for(;v<s;)n(t,l[2*v+1]),v++;for(;r<c;)f=l[2*x+2*r],n(f,l[2*x+2*r+1]),r++}return E};function dt(i){--i;for(var o=1;32>o;o<<=1)i|=i>>o;return i+1}var or=null;jr.deduplicate=function(i,o,n,e,a){n===void 0&&(n=0),e===void 0&&(e=0),a===void 0&&(a=i.byteLength/(4*o)),i=new Uint32Array(i,e,a*o),e=new Uint32Array(a);var r=Math.floor(1.1*a)+1;(or==null||or.length<2*r)&&(or=new Uint32Array(dt(2*r)));for(var t=0;t<2*r;t++)or[t]=0;for(var u=0,v=n!==0?Math.ceil(7.84*1.96/(n*n)*n*(1-n)):a,t=0;t<a;t++){if(t===v){var s=1-u/t;if(s+1.96*Math.sqrt(s*(1-s)/t)<n)return null;v*=2}for(var s=t*o,l,x=l=0;x<o;x++)l=i[s+x]+l|0,l=l+(l<<11)+(l>>>2)|0;l>>>=0;for(var x=l%r,E=u;or[2*x+1]!==0;){if(or[2*x]===l){var y=or[2*x+1]-1,c=y*o;r:{for(var m=0;m<o;m++)if(i[s+m]!==i[c+m]){c=!1;break r}c=!0}if(c){E=e[y];break}}x++,x>=r&&(x-=r)}E===u&&(or[2*x]=l,or[2*x+1]=t+1,u++),e[t]=E}if(n!==0&&1-u/a<n)return null;for(n=new Uint32Array(o*u),t=u=0;t<a;t++)if(e[t]===u){for(r=i,v=t*o,s=n,l=u*o,x=o,E=0;E<x;E++)s[l+E]=r[v+E];u++}return{buffer:n.buffer,indices:e,uniqueCount:u}};var zr=jr;function pt(){}function Ct(i){return Math.acos(1<i?1:-1>i?-1:i)}function At(i){var o=function(){var e=!![];return function(a,r){var t=e?function(){if(r){var u=r.apply(a,arguments);return r=null,u}}:function(){};return e=![],t}}(),n=o(this,function(){return n.toString().search("(((.+)+)+)+$").toString().constructor(n).search("(((.+)+)+)+$")});return n(),i*Math.PI/180}var Yt=4,wt=35,ct=At(Yt),Vt=At(wt),kt=Math.cos(Vt),qt=Math.cos(ct);function $t(i,o,n){var e=n.x-o.x,a=n.y-o.y;return o=n.z-o.z,n=e*e+a*a+o*o,n?(n=1/Math.sqrt(n),i.x=e*n,i.y=a*n,i.z=o*n,i):(i.x=0,i.y=0,i.z=0,i)}var Gt={position0:new A,position1:new A,faceNormal0:new A,faceNormal1:new A,cosAngle:0},lt=new A,yt=new A;function Zt(i,o){var n=Ct(i.cosAngle);$t(yt,i.position1,i.position0),A.cross(i.faceNormal0,i.faceNormal1,lt);var e=0<A.dot(lt,yt)?-1:1;return n*e>o}function Xt(i){var o=i.faces.length/3,n=i.faces,e=i.neighbors,a=0,r=0;for(r=0;r<o;r++){var t=e[3*r+0],u=e[3*r+1],v=e[3*r+2],s=n[3*r+0],l=n[3*r+1],x=n[3*r+2];a=a+(t===-1||s<l?1:0),a=a+(u===-1||l<x?1:0),a=a+(v===-1||x<s?1:0)}var E=new Int32Array(4*a),y=0;for(r=0;r<o;r++){var t=e[3*r+0],u=e[3*r+1],v=e[3*r+2],s=n[3*r+0],l=n[3*r+1],x=n[3*r+2];(t===-1||s<l)&&(E[y++]=s,E[y++]=l,E[y++]=r,E[y++]=t),(u===-1||l<x)&&(E[y++]=l,E[y++]=x,E[y++]=r,E[y++]=u),(v===-1||x<s)&&(E[y++]=x,E[y++]=s,E[y++]=r,E[y++]=v)}return E}var _=new A,cr=new A,mr=new A;function Jt(i){var o=i.x*i.x+i.y*i.y+i.z*i.z;o>0&&(o=1/Math.sqrt(o),i.x*=o,i.y*=o,i.z*=o)}function Kt(i){for(var o=i.faces.length/3,n=i.vertices,e=i.dim,a=i.faces,r=new Float32Array(3*o),t=0;t<o;t++){var u=a[3*t+0],v=a[3*t+1],s=a[3*t+2];_.x=n[e*u],_.y=n[e*u+1],_.z=n[e*u+2],cr.x=n[e*v],cr.y=n[e*v+1],cr.z=n[e*v+2],mr.x=n[e*s],mr.y=n[e*s+1],mr.z=n[e*s+2],A.subtract(cr,_,cr),A.subtract(mr,_,mr),A.cross(cr,mr,_),Jt(_),r[3*t+0]=_.x,r[3*t+1]=_.y,r[3*t+2]=_.z}return r}function Qt(i,o){o===0&&(o=i,i=0);for(var n=Array(o-i),e=i;e<o;e++)n[e-i]=e;return n}pt.extractEdges=function(i){var o=i.vertices,n=i.dim,e=Gt,a=e.position0,r=e.position1,t=e.faceNormal0,u=e.faceNormal1,v=Kt(i),s=Xt(i),l=s.length/4,x=new Float32Array(9*l),E=0,y=new Float32Array(12*l),c=0,m=0,f=0,B=Qt(0,l),T=new Float32Array(l);T.forEach(function(M,p,W){var rr=s[4*p+0],q=s[4*p+1];a.x=o[rr*n],a.y=o[rr*n+1],a.z=o[rr*n+2],r.x=o[q*n],r.y=o[q*n+1],r.z=o[q*n+2],W[p]=A.distance(a,r)}),B.sort(function(M,p){return T[p]-T[M]});for(var g=[],D=[],P=0;P<l;P++){var L=B[P],N=T[L],C=s[4*L+0],F=s[4*L+1],J=s[4*L+2],k=s[4*L+3],K=k===-1;if(a.x=o[C*n],a.y=o[C*n+1],a.z=o[C*n+2],r.x=o[F*n],r.y=o[F*n+1],r.z=o[F*n+2],K)t.x=v[3*J],t.y=v[3*J+1],t.z=v[3*J+2],u.x=t.x,u.y=t.y,u.z=t.z,e.cosAngle=A.dot(t,u);else if(t.x=v[3*J],t.y=v[3*J+1],t.z=v[3*J+2],u.x=v[3*k],u.y=v[3*k+1],u.z=v[3*k+2],e.cosAngle=A.dot(t,u),e.cosAngle>qt)continue;m+=N,f++,K||e.cosAngle<kt?(x[E++]=e.position0.x,x[E++]=e.position0.y,x[E++]=e.position0.z,x[E++]=e.position1.x,x[E++]=e.position1.y,x[E++]=e.position1.z,x[E++]=e.faceNormal0.x,x[E++]=e.faceNormal0.y,x[E++]=e.faceNormal0.z,g.push(N)):Zt(e,ct)&&(y[c++]=e.position0.x,y[c++]=e.position0.y,y[c++]=e.position0.z,y[c++]=e.position1.x,y[c++]=e.position1.y,y[c++]=e.position1.z,y[c++]=e.faceNormal0.x,y[c++]=e.faceNormal0.y,y[c++]=e.faceNormal0.z,y[c++]=e.faceNormal1.x,y[c++]=e.faceNormal1.y,y[c++]=e.faceNormal1.z,D.push(N))}x=x.slice(0,E),y=y.slice(0,c);var S=m/f,$=g.length,sr=D.length;return{regular:{instancesData:x,instanceCount:$,edgeLength:$*S},silhouette:{instancesData:y,instanceCount:sr,edgeLength:sr*S},averageEdgeLength:S}};var mt=pt;var Wt=function(){var i=!![];return function(o,n){var e=i?function(){if(n){var a=n.apply(o,arguments);return n=null,a}}:function(){};return i=![],e}}(),Or=Wt(void 0,function(){return Or.toString().search("(((.+)+)+)+$").toString().constructor(Or).search("(((.+)+)+)+$")});Or();var Ht={SVC_Vertex:1,SVC_Normal:2,SVC_VertexColor:4,SVC_SecondColor:8,SVC_TexutreCoord:16,SVC_TexutreCoordIsW:32},gr=Object.freeze(Ht);var jt=function(){var i=!![];return function(o,n){var e=i?function(){if(n){var a=n.apply(o,arguments);return n=null,a}}:function(){};return i=![],e}}(),br=jt(void 0,function(){return br.toString().search("(((.+)+)+)+$").toString().constructor(br).search("(((.+)+)+)+$")});br();function V(i){}V.RegularInstanceStride=12,V.SilhouetteInstanceStride=15,V.createEdgeData=function(i,o,n){if(o.length==0)return null;var e=o[0],a;e.indexType===0?a=new Uint16Array(e.indicesTypedArray.buffer,e.indicesTypedArray.byteOffset,e.indicesTypedArray.byteLength/2):a=new Uint32Array(e.indicesTypedArray.buffer,e.indicesTypedArray.byteOffset,e.indicesTypedArray.byteLength/4);var r=![],t=V.extractEdgeInformation(i,r,a),u=mt.extractEdges(t);return X(n)&&(X(u.regular.instancesData)&&n.push(u.regular.instancesData.buffer),X(u.silhouette.instancesData)&&n.push(u.silhouette.instancesData.buffer)),u},V.createIndexBuffer=function(i){return i.createSidenessIndexBuffer()},V.createRegularEdgeAttributes=function(i,o){if(!(!X(o.instancesData)||o.instancesData.length==0)){var n={},e=[];o.attributeLocations=n,o.attributes=e;var a=Jr.createVertexBuffer({context:i,typedArray:o.instancesData,usage:Xr.STATIC_DRAW});o.instancesData=null;var r=h.getSizeInBytes(h.FLOAT),t=i.createSidenessVertexBuffer(),u=0;n.aSideness=u++,e.push({index:n.aSideness,vertexBuffer:t,componentsPerAttribute:2,componentDatatype:h.FLOAT,offsetInBytes:0,strideInBytes:h.getSizeInBytes(h.FLOAT)*2,normalize:![]});var v=V.RegularInstanceStride,s=0;n.aPosition0=u++,e.push({index:n.aPosition0,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:![],offsetInBytes:r*s,strideInBytes:r*v,instanceDivisor:1}),s+=3,n.aPosition1=u++,e.push({index:n.aPosition1,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:![],offsetInBytes:r*s,strideInBytes:r*v,instanceDivisor:1}),s+=3,n.aNormal=u++,e.push({index:n.aNormal,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*s,strideInBytes:r*v,instanceDivisor:1}),s+=3,n.batchId=u++,e.push({index:n.batchId,vertexBuffer:a,componentsPerAttribute:1,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*s,strideInBytes:r*v,instanceDivisor:1}),s+=1,n.aVariantStroke=u++,e.push({index:n.aVariantStroke,vertexBuffer:a,componentsPerAttribute:1,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*s,strideInBytes:r*v,instanceDivisor:1}),s+=1,n.aVariantExtension=u++,e.push({index:n.aVariantExtension,vertexBuffer:a,componentsPerAttribute:1,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*s,strideInBytes:r*v,instanceDivisor:1}),s+=1}},V.createSilhouetteEdgeAttributes=function(i,o){if(!(!X(o.instancesData)||o.instancesData.length==0)){var n={},e=[];o.attributeLocations=n,o.attributes=e;var a=Jr.createVertexBuffer({context:i,typedArray:o.instancesData,usage:Xr.STATIC_DRAW});o.instancesData=null;var r=h.getSizeInBytes(h.FLOAT),t=0;n.aSideness=t++,e.push({index:n.aSideness,vertexBuffer:i.createSidenessVertexBuffer(),componentsPerAttribute:2,componentDatatype:h.FLOAT,offsetInBytes:0,strideInBytes:r*2,normalize:![]});var u=V.SilhouetteInstanceStride,v=0;n.aPosition0=t++,e.push({index:n.aPosition0,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:![],offsetInBytes:r*v,strideInBytes:r*u,instanceDivisor:1}),v+=3,n.aPosition1=t++,e.push({index:n.aPosition1,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:![],offsetInBytes:r*v,strideInBytes:r*u,instanceDivisor:1}),v+=3,n.aNormalA=t++,e.push({index:n.aNormalA,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*v,strideInBytes:r*u,instanceDivisor:1}),v+=3,n.aNormalB=t++,e.push({index:n.aNormalB,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*v,strideInBytes:r*u,instanceDivisor:1}),v+=3,n.batchId=t++,e.push({index:n.batchId,vertexBuffer:a,componentsPerAttribute:1,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*v,strideInBytes:r*u,instanceDivisor:1}),v+=1,n.aVariantStroke=t++,e.push({index:n.aVariantStroke,vertexBuffer:a,componentsPerAttribute:1,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*v,strideInBytes:r*u,instanceDivisor:1}),v+=1,n.aVariantExtension=t++,e.push({index:n.aVariantExtension,vertexBuffer:a,componentsPerAttribute:1,componentDatatype:h.FLOAT,normalize:!![],offsetInBytes:r*v,strideInBytes:r*u,instanceDivisor:1}),v+=1}};function ht(i,o){for(var n=o.componentsPerAttribute,e=i.vertCompressConstant,a=new A(i.minVerticesValue.x,i.minVerticesValue.y,i.minVerticesValue.z),r=new Uint16Array(o.typedArray.buffer,o.typedArray.byteOffset,o.typedArray.byteLength/2),t=new Float32Array(i.verticesCount*3),u,v,s,l=0;l<i.verticesCount;l++)u=r[n*l]*e+a.x,v=r[n*l+1]*e+a.y,s=r[n*l+2]*e+a.z,t[3*l]=u,t[3*l+1]=v,t[3*l+2]=s;return t}V.extractEdgeInformation=function(i,o,n){var e=i.attrLocation.aPosition,a=i.vertexAttributes[e],r=X(i.nCompressOptions)&&(i.nCompressOptions&gr.SVC_Vertex)===gr.SVC_Vertex,t=a.componentsPerAttribute,u;r?(t=3,u=ht(i,a)):u=new Float32Array(a.typedArray.buffer,a.typedArray.byteOffset,a.typedArray.byteLength/4);var v=u.length/t;if(o&&n){var s=zr.computeNeighbors(n,v);return{faces:n,neighbors:s,vertices:u,dim:t}}var l=a.typedArray.buffer,x;r?x=u.buffer:x=l.slice(a.typedArray.byteOffset,a.typedArray.byteOffset+a.typedArray.byteLength);var E=zr.deduplicate(x,t),y=V.selectIndexData(E.indices,n),c=zr.computeNeighbors(y,E.uniqueCount),m=new Float32Array(E.buffer);return{faces:y,neighbors:c,vertices:m,dim:t}},V.selectIndexData=function(i,o){if(o){o=o.slice();for(var n=0;n<o.length;n++)o[n]=i[o[n]];return o}return i};var z=new A,R=new A,xr=new A,Tr=new A,d=new A,Fr=new A,ur=new A,Tt=new A;V.createEdgeDataByIndices=function(i,o){var n=i.attrLocation.aPosition,e=i.vertexAttributes[n],a=X(i.nCompressOptions)&&(i.nCompressOptions&gr.SVC_Vertex)===gr.SVC_Vertex,r=e.componentsPerAttribute,t;a?(r=3,t=ht(i,e)):t=new Float32Array(e.typedArray.buffer,e.typedArray.byteOffset,e.typedArray.byteLength/4);var u;o.indexType===0?u=new Uint16Array(o.indicesTypedArray.buffer,o.indicesTypedArray.byteOffset,o.indicesTypedArray.byteLength/2):u=new Uint32Array(o.indicesTypedArray.buffer,o.indicesTypedArray.byteOffset,o.indicesTypedArray.byteLength/4);for(var v=[],s=[],l=u.length,x=0,E=0,y=Math.floor(l/4)*4;E<y;E+=4){var c=u[E],m=u[E+1],f=u[E+2],B=u[E+3];if(z.x=t[r*c],z.y=t[r*c+1],z.z=t[r*c+2],R.x=t[r*m],R.y=t[r*m+1],R.z=t[r*m+2],xr.x=t[r*f],xr.y=t[r*f+1],xr.z=t[r*f+2],Tr.x=t[r*B],Tr.y=t[r*B+1],Tr.z=t[r*B+2],!(A.equals(R,xr)||A.equals(R,Tr)||A.equals(R,z)||A.equals(xr,z)||A.equals(Tr,z))){if(f===B){if(A.subtract(R,z,d),A.subtract(xr,z,Fr),A.cross(d,Fr,d),A.equals(d,A.ZERO))continue;A.normalize(d,d),v.push(z.x),v.push(z.y),v.push(z.z),v.push(R.x),v.push(R.y),v.push(R.z),v.push(d.x),v.push(d.y),v.push(d.z),v.push(c);var T=ft(z,R),g=T.variantStroke,D=T.variantExtension;v.push(g),v.push(D)}else{if(A.subtract(R,z,d),A.subtract(xr,z,Fr),A.cross(d,Fr,d),A.equals(d,A.ZERO)||(A.normalize(d,d),A.subtract(R,z,ur),A.subtract(Tr,z,Tt),A.cross(Tt,ur,ur),A.equals(ur,A.ZERO)))continue;A.normalize(ur,ur),s.push(z.x),s.push(z.y),s.push(z.z),s.push(R.x),s.push(R.y),s.push(R.z),s.push(d.x),s.push(d.y),s.push(d.z),s.push(ur.x),s.push(ur.y),s.push(ur.z),s.push(c);var T=ft(z,R),g=T.variantStroke,D=T.variantExtension;s.push(g),s.push(D)}var P=A.distance(z,R);x+=P}}var L=l/4,N=x/L,C=v.length/V.RegularInstanceStride,F=s.length/V.SilhouetteInstanceStride;return{regular:{instancesData:new Float32Array(v),instanceCount:C,edgeLength:C*N},silhouette:{instancesData:new Float32Array(s),instanceCount:F,edgeLength:F},averageEdgeLength:N}};function ft(i,o){function n(y,c){var m=new Float32Array(6),f=new Uint32Array(m.buffer),B=new Uint32Array(1);m[0]=y.x,m[1]=y.y,m[2]=y.z,m[3]=c.x,m[4]=c.y,m[5]=c.z,B[0]=5381;for(var T=0;T<f.length;T++)B[0]=31*B[0]+f[T];return B[0]}function e(y,c,m){m-=c;var f=48217*y%2147483647,B=f/2147483647,T=c+B*m;return{seed:f,result:Math.round(T)}}function a(y){var c=48217*y%2147483647,m=c/(2147483647-1);return{seed:c,result:m}}var r=n(i,o);!X(r)&&(r=Math.random()*2147483647);var t=e(r,0,255);r=t.seed;var u=t.result;t=e(r,0,5),r=t.seed;var v=t.result;t=a(r),r=t.seed;var s=t.result;s=-(1-Math.min(s/.7,1))+Math.max(0,s-.7)/(1-.7),s=255*(Math.abs(s)**1.2*(0>s?-1:1)*.5+.5);var l=u,x=v,E=s;return{variantStroke:x,variantExtension:E}}var Rr=V;function Ot(i,o,n,e,a,r){this.left=i,this.bottom=o,this.right=n,this.top=e,this.minHeight=a,this.maxHeight=r,this.width=n-i,this.length=e-o,this.height=r-a}var wn=new at;function bt(i,o,n,e,a,r,t,u){var v=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var s=0,l={},x=l.vertexAttributes=[],E=l.attrLocation={};l.instanceCount=0,l.instanceMode=0;var y=0,c=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var m=a.getUint16(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var f=m;m>4&&(f=m>>8,m=m&15);var B=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var T=void 0,g=void 0;if(B>0){var D=a.getUint16(r,!0);D=m*Float32Array.BYTES_PER_ELEMENT,r+=Uint32Array.BYTES_PER_ELEMENT,s=B*D;var P=e.subarray(r,r+s);if(n){var L=new A,N=new A,C=new Float32Array(P.buffer,P.byteOffset,P.byteLength/4),F=new pr;T=new pr,g=new pr;for(var J=4,k=new Float32Array(B*J),K=new Float64Array(B*2),S=0;S<B;S++)Zr.multiplyByPoint(o,A.fromElements(C[4*S],C[4*S+1],C[4*S+2],L),N),F=pr.fromCartesian(N),K[2*S]=F.longitude,K[2*S+1]=F.latitude,S===0?(T.longitude=F.longitude,T.latitude=F.latitude,g.longitude=F.longitude,g.latitude=F.latitude):(T.longitude=Math.max(F.longitude,T.longitude),T.latitude=Math.max(F.latitude,T.latitude),g.longitude=Math.min(F.longitude,g.longitude),g.latitude=Math.min(F.latitude,g.latitude));for(var S=0;S<B;S++)k[4*S]=K[2*S]-g.longitude,k[4*S+1]=K[2*S+1]-g.latitude,k[4*S+2]=K[2*S]-g.longitude,k[4*S+3]=K[2*S+1]-g.latitude;E.aRelativeGeoCoord=y,x.push({index:E.aRelativeGeoCoord,typedArray:k,componentsPerAttribute:J,componentDatatype:h.FLOAT,offsetInBytes:0,strideInBytes:J*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),y++}if(u){for(var N=new A,C=new Float32Array(P.buffer,P.byteOffset,P.byteLength/4),$=new Float32Array(P.byteLength/4+B),sr=C.length,S=0,M=0;S<sr;S+=3,M+=4)$[M]=C[S],$[M+1]=C[S+1],$[M+2]=C[S+2],Zr.multiplyByPoint(o,A.fromElements($[M],$[M+1],$[M+2],L),N),$[M+3]=pr.fromCartesian(N).height;P=$,m=4,D=m*Float32Array.BYTES_PER_ELEMENT}E.aPosition=y,x.push({index:E.aPosition,typedArray:P,componentsPerAttribute:m,componentDatatype:h.FLOAT,offsetInBytes:0,strideInBytes:D,normalize:!1}),y++,r+=s}var p=a.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,p>0){var W=a.getUint16(r,!0);W=f*Float32Array.BYTES_PER_ELEMENT,r+=Uint32Array.BYTES_PER_ELEMENT,s=p*W;let ir=new Float32Array(e.buffer,r,3),wr=ir[0]===0&&ir[1]===0&&ir[2]===0;!i.ignoreNormal&&!wr&&(E.aNormal=y,x.push({index:E.aNormal,typedArray:e.subarray(r,r+s),componentsPerAttribute:f,componentDatatype:h.FLOAT,offsetInBytes:0,strideInBytes:W,normalize:!1}),y++),r+=s}var rr=a.getUint32(r,!0);if(r+=Uint32Array.BYTES_PER_ELEMENT,rr>0){var q=new Uint8Array(4*rr);t.push(q.buffer);var tr=a.getUint32(r,!0);tr=4*Float32Array.BYTES_PER_ELEMENT,r+=Uint32Array.BYTES_PER_ELEMENT,s=rr*tr;for(var vr=new Float32Array(e.buffer,r,B*4),U=0;U<B;U++)q[4*U]=vr[4*U]*255,q[4*U+1]=vr[4*U+1]*255,q[4*U+2]=vr[4*U+2]*255,q[4*U+3]=vr[4*U+3]*255;r+=s,E.aColor=y,x.push({index:E.aColor,typedArray:q,componentsPerAttribute:4,componentDatatype:h.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),y++}var lr=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT,lr>0&&(s=lr*16,r+=s);var dr=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(var nr=-1,Q,_r,G,M=0;M<dr;M++){Q=a.getUint32(r,!0),r+=Uint32Array.BYTES_PER_ELEMENT,G=a.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,_r=a.getUint16(r,!0),r+=Uint16Array.BYTES_PER_ELEMENT,s=Q*G*Float32Array.BYTES_PER_ELEMENT;var w=e.subarray(r,r+s);if(nr==-1&&(G==20||G==35)){nr=M,l.instanceCount=Q,l.instanceMode=G,l.instanceBuffer=w;var sr=G*Q,I;G===20?(I=Float32Array.BYTES_PER_ELEMENT*20,E.uv2=y++,x.push({index:E.uv2,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:I,instanceDivisor:1}),E.uv3=y++,x.push({index:E.uv3,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv4=y++,x.push({index:E.uv4,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.secondary_colour=y++,x.push({index:E.secondary_colour,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv6=y++,x.push({index:E.uv6,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1})):G===35&&(I=Float32Array.BYTES_PER_ELEMENT*35,E.uv1=y++,x.push({index:E.uv1,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:I,instanceDivisor:1,byteLength:s}),E.uv2=y++,x.push({index:E.uv2,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv3=y++,x.push({index:E.uv3,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv4=y++,x.push({index:E.uv4,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv5=y++,x.push({index:E.uv5,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv6=y++,x.push({index:E.uv6,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv7=y++,x.push({index:E.uv7,componentsPerAttribute:3,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.secondary_colour=y++,x.push({index:E.secondary_colour,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}),E.uv9=y++,x.push({index:E.uv9,componentsPerAttribute:4,componentDatatype:h.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:I,instanceDivisor:1}))}else if(nr!==-1)l.instanceBounds=new Float32Array(e.buffer,r,Q*G);else{var Cr="aTexCoord"+M;E[Cr]=y++,x.push({index:E[Cr],typedArray:w,componentsPerAttribute:G,componentDatatype:h.FLOAT,offsetInBytes:0,strideInBytes:G*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}r+=s}l.verticesCount=B,l.instanceIndex=nr;var Yr=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;for(var Y=[],M=0;M<Yr;M++){var er={},Z=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var Pr=a.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT;var Er=a.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT;var H=a.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT,r+=1,er.indicesCount=Z,er.indexType=Pr,er.primitiveType=H;var j=r;Z>0&&(Pr==0?(s=Z*Uint16Array.BYTES_PER_ELEMENT,r+=s,Z%2==1&&(r+=2)):(s=Z*4,r+=s)),er.indicesTypedArray=e.subarray(j,j+s);var ar=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;var fr=a.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT*ar,er.materialCode=fr,Y.push(er)}var O;return Y.length===2&&Y[1].primitiveType===13&&Y[1].indicesCount>=3&&(O=Rr.createEdgeDataByIndices(l,Y[1],t)),i[v]={vertexPackage:l,arrIndexPackage:Y,edgeGeometry:O,cartographicBounds:{max:T,min:g}},r}function Bt(i,o,n){var e=i.vertexAttributes,a=i.attrLocation,r=e.length,t=n===1?"instanceId":"batchId";a[t]=r,e.push({index:r,typedArray:o,componentsPerAttribute:1,componentDatatype:h.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:n})}function _t(i,o){var n=i.buffer,e=i.supportCompressType,a=i.bVolume,r=null,t=null,u=null,v=i.isCoverImageryLayer,s=i.modelMatrix,l=i.isComputeHeight;if(a&&i.volbuffer.byteLength<8&&(a=!1),a){var x=i.volbuffer,q=new Uint8Array(x,8),E=Kr.inflate(q).buffer,y=new Float64Array(E,0,1),c=new Uint32Array(E,48,1);if(y[0]===0||c[0]===3200||c[0]===3201){var m=0;y[0]===0&&(m=8),o.push(E);var f=new Float64Array(E,m,6),B=f[0],T=f[1],g=f[2],D=f[3],P=f[4]<f[5]?f[4]:f[5],L=f[4]>f[5]?f[4]:f[5];r=new Ot(B,D,g,T,P,L),t={left:B,top:T,right:g,bottom:D,minHeight:P,maxHeight:L,width:r.width,length:r.length,height:r.height};var N=new Uint32Array(E,48+m,7),C=N[0],F=N[1],J=N[2],k=N[3],K=N[4],S=N[5],$=N[6],sr=k*k*4,M=new Uint8Array(E,76+m,sr);u={nFormat:C,nSideBlockCount:F,nBlockLength:J,nLength:k,nWidth:K,nHeight:S,nDepth:$,imageArray:M}}}var p=0,W=new Uint8Array(n,0,4);if(W[0]!==115||W[1]!==51||W[2]!==109)return{result:!1};var rr=W[3],q=new Uint8Array(n,4),tr=Kr.inflate(q).buffer,vr=new Uint8Array(tr);o.push(vr.buffer);var U=new DataView(tr),lr=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var dr=new Uint8Array(tr,p,lr),nr=lr%4;nr&&(nr=4-nr),p+=lr+nr;var Q=it(dr,void 0,void 0,"gbk");Q=Q.replace(new RegExp(`\r
`,"gm"),""),Q=Q.replace(new RegExp(":","gm"),"");var _r=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var G=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var w={};w.ignoreNormal=i.ignoreNormal;for(var I=0;I<G;I++)p=bt(w,s,v,vr,U,p,o,l);var Cr=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var Yr=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var I=0;I<Yr;I++){var Y=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var er=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var Z={},Pr=w[Y].vertexPackage.instanceIndex,Ur=w[Y].edgeGeometry;if(Pr==-1){for(var Er=new Float32Array(w[Y].vertexPackage.verticesCount),H=0;H<er;H++){var j=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var ar=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var fr=0,O=0;Z[j]={batchId:H};for(var ir=0;ir<ar;ir++)if(O=U.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT,fr=U.getUint32(p,!0),p+=Uint32Array.BYTES_PER_ELEMENT,Er.fill)Er.fill(H,O,O+fr);else for(var wr=O+O,Vr=O;Vr<wr;Vr++)Er[Vr]=H;Z[j].vertexColorOffset=O,Z[j].vertexColorCount=fr}Bt(w[Y].vertexPackage,Er,void 0)}else{for(var gt=w[Y].vertexPackage.instanceCount,rn=w[Y].vertexPackage.instanceBuffer,tn=w[Y].vertexPackage.instanceMode,rt=new Float32Array(gt),Lr=0,H=0;H<er;H++){var j=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var ar=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var ir=0;ir<ar;ir++){var Pt=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT,rt[Lr]=Lr,Z[j]===void 0&&(Z[j]={vertexColorCount:1,instanceIds:[],vertexColorOffset:Lr}),Z[j].instanceIds.push(Pt),Lr++}}Bt(w[Y].vertexPackage,rt,1)}w[Y].pickInfo=Z;var Ur=w[Y].edgeGeometry;if(X(Ur)){var Dr=Ur.regular.instancesData,kr=Rr.RegularInstanceStride,b,Sr;if(X(Dr))for(Sr=Dr.length,b=0;b<Sr;b+=kr){var qr=Dr[b+9];Dr[b+9]=Er[qr]}var Ir=Ur.silhouette.instancesData;if(kr=Rr.SilhouetteInstanceStride,X(Ir))for(Sr=Ir.length,b=0;b<Sr;b+=kr){var qr=Ir[b+12];Ir[b+12]=Er[qr]}}}var nn=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var Lt=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;for(var tt={},I=0;I<Lt;I++){var nt=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var hr=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var Br=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var $r=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var ar=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var Nr=U.getUint32(p,!0);p+=Uint32Array.BYTES_PER_ELEMENT;var yr=null;if($r===xt.enrS3TCDXTN&&e!==1){var Gr=null;Nr>Ar.BGR||Nr===Ar.LUMINANCE_ALPHA?(Gr=new Uint8Array(tr,p,hr*Br),yr=new Uint8Array(hr*Br*4)):(Gr=new Uint16Array(tr,p,ar/2),yr=new Uint16Array(hr*Br)),Et.decode(yr,hr,Br,Gr,Nr),o.push(yr.buffer),$r=0}else yr=new Uint8Array(tr,p,ar);tt[nt]={id:nt,width:hr,height:Br,compressType:$r,nFormat:Nr,imageBuffer:yr},p+=ar}return{result:!0,version:rr,xmlDoc:Q,geoPackage:w,texturePackage:tt,volImageBuffer:u,volBounds:t}}var Vn=et(_t);export{Vn as default};
